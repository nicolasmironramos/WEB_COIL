<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Estudio estadístico de los Accidentes de Bicicletas en Madrid en 2023</title>
    <link rel="stylesheet" href="https://pyscript.net/latest/pyscript.css" />
    <script defer src="https://pyscript.net/latest/pyscript.js"></script>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 0;
        }
        h1 {
            text-align: center;
            margin-top: 50px;
        }
        h2 {
            margin-top: 30px;
        }
        .container {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            margin-top: 50px;
        }
        .chart {
            width: 400px;
            height: 400px;
            margin: 20px;
        }
        #map {
            height: 500px;
            margin-top: 50px;
        }
    </style>
</head>
<body>
        <h1>Estudio estadístico de los Accidentes de Bicicletas en Madrid en 2023</h1>
        <p>Este estudio se realizó con el objetivo de analizar los accidentes de bicicletas en Madrid en el año 2023. Se analizaron diferentes variables como el estado meteorológico, el tipo de accidente, el tipo de vehículo, el tipo de persona, el sexo del accidentado, la lesividad del accidente y el distrito donde ocurrió el accidente.</p>
        <div class="container">
            <div class="chart">
                <h2>Frecuencia de accidentes por día de la semana</h2>
                <div id="dia-semana"></div>
            </div>
            <div class="chart">
                <h2>Proporción de accidentes por hora del día</h2>
                <div id="hora-dia"></div>
            </div>
        </div>
        <h2>Estado meteorológico cuando ocurre accidente</h2>
        <div id="estado-meteorologico"></div>
        <h2>Tipo de accidente</h2>
        <div id="tipo-accidente"></div>
        <h2>Tipo de vehículo</h2>
        <div id="tipo-vehiculo"></div>
        <h2>Tipo de persona</h2>
        <div id="tipo-persona"></div>
        <h2>Sexo del accidentado</h2>
        <div id="sexo-accidentado"></div>
        <h2>Lesividad del accidente</h2>
        <div id="lesividad-accidente"></div>
        <h2>Distrito donde ocurrió el accidente</h2>
        <div id="distrito-accidente"></div>
        <h2>Promedio del código de distrito</h2>
        <div id="promedio-distrito"></div>
        <div id="map"></div>
        <py-config>
                packages = ["pandas", "matplotlib", "folium"]
                plugins = [
                        "https://pyscript.net/latest/plugins/python/py_tutor.py"
                ]
        </py-config>
        <script type="py">
                import pandas as pd
                import numpy as np
                import matplotlib.pyplot as plt
                import folium

                # Load data from a web-accessible Excel file. This is my personal URL, so you'll need to modify it for it to work.
                excel_file_url = '/Users/nicolasmiron/Desktop/TECNOLOGIAS MOVILES Y WEB/CONVIVE/datos/AccidentesBicicletas_2023.xlsx'
                df_accidentes = pd.read_excel(excel_file_url)
                df_accidentes.head(10)

                df_accidentes.isna().sum()

                df_accidentes["estado_meteorológico"] = df_accidentes["estado_meteorológico"].fillna(value="Se desconoce")
                conteo_edomet = df_accidentes["estado_meteorológico"].value_counts()
                plt.figure(figsize=(10,5))
                plt.bar(conteo_edomet.index, conteo_edomet.values)
                plt.xlabel("Estado Meteorologico")
                plt.ylabel("Frecuencia")
                plt.title("Estado metereologico cuando ocurre accidente")
                plt.show()

                df_accidentes["tipo_accidente"] = df_accidentes["tipo_accidente"].fillna(value="NULL")
                conteo_edomet2 = df_accidentes["tipo_accidente"].value_counts()
                plt.figure(figsize=(10,5))
                plt.bar(conteo_edomet2.index, conteo_edomet2.values)
                plt.xlabel("Accidente")
                plt.ylabel("Frecuencia")
                plt.title("Tipo de accidente")
                plt.show()

                df_accidentes["tipo_vehiculo"] = df_accidentes["tipo_vehiculo"].fillna(value="NULL")
                conteo_edomet3 = df_accidentes["tipo_vehiculo"].value_counts()
                plt.figure(figsize=(10,5))
                plt.bar(conteo_edomet3.index, conteo_edomet3.values)
                plt.xlabel("Vehiculo")
                plt.ylabel("Frecuencia")
                plt.title("Tipo de Vehiculo")
                plt.show()

                df_accidentes["tipo_persona"] = df_accidentes["tipo_persona"].fillna(value="NULL")
                conteo_edomet4 = df_accidentes["tipo_persona"].value_counts()
                plt.figure(figsize=(10,5))
                plt.bar(conteo_edomet4.index, conteo_edomet4.values)
                plt.xlabel("Persona")
                plt.ylabel("Frecuencia")
                plt.title("Tipo de persona")
                plt.show()

                df_accidentes["sexo"] = df_accidentes["sexo"].fillna(value="NULL")
                conteo_edomet5 = df_accidentes["sexo"].value_counts()
                plt.figure(figsize=(10,5))
                plt.bar(conteo_edomet5.index, conteo_edomet5.values)
                plt.xlabel("Sexo")
                plt.ylabel("Frecuencia")
                plt.title("Sexo de accidentado")
                plt.show()

                df_accidentes["lesividad"] = df_accidentes["lesividad"].fillna(value="NULL")
                conteo_edomet6 = df_accidentes["lesividad"].value_counts()
                plt.figure(figsize=(10,5))
                plt.bar(conteo_edomet6.index, conteo_edomet6.values)
                plt.xlabel("Lesion")
                plt.ylabel("Frecuencia")
                plt.title("Lesividad de accidente")
                plt.show()

                df_accidentes["distrito"] = df_accidentes["distrito"].fillna(value="NULL")
                conteo_edomet7 = df_accidentes["distrito"].value_counts()
                plt.figure(figsize=(10,5))
                plt.bar(conteo_edomet7.index, conteo_edomet7.values)
                plt.xlabel("Distrito")
                plt.ylabel("Frecuencia")
                plt.title("Distrito donde ocurrio el accidente")
                plt.show()

                promedio_distrito = df_accidentes["cod_distrito"].mean()
                print("El promedio del codigo de distrito")
                print(promedio_distrito)
                promedio_distrito_html = "<p>" + str(promedio_distrito) + "</p>"
                display.display_html(promedio_distrito_html, raw=True)

                # Frecuencia de accidentes por día de la semana
                df_accidentes["dia_semana"] = df_accidentes["fecha"].dt.day_name()
                conteo_dia_semana = df_accidentes["dia_semana"].value_counts()
                plt.figure(figsize=(10,5))
                plt.bar(conteo_dia_semana.index, conteo_dia_semana.values)
                plt.xlabel("Día de la semana")
                plt.ylabel("Frecuencia")
                plt.title("Frecuencia de accidentes por día de la semana")
                plt.show()

                # Proporción de accidentes por hora del día
                df_accidentes["hora"] = df_accidentes["fecha"].dt.hour
                conteo_hora = df_accidentes["hora"].value_counts()
                labels = [f"{i}:00 - {i+1}:00" for i in range(24)]
                plt.figure(figsize=(10,5))
                plt.pie(conteo_hora.values, labels=labels, autopct='%1.1f%%')
                plt.title("Proporción de accidentes por hora del día")
                plt.show()

                # Mapa interactivo de accidentes
                m = folium.Map(location=[40.4168, -3.7038], zoom_start=12)
                for index, row in df_accidentes.iterrows():
                        folium.Marker([row['latitud'], row['longitud']]).add_to(m)
                display.display_html(m._repr_html_(), raw=True)

        </script>
</body>
</html>
